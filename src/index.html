<!DOCTYPE HTML>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <base href="http://192.168.0.176/" /> TODO Remove in prod -->
    <style type="text/css">
        input {
            padding: 1ex;
            margin: 1ex;
        }

        input[type="text"] {
            width: 80%;
        }

        button {
            width: 80%;
            padding: 1ex;
            margin: 1ex;
            /* height: 6ex; */
        }
    </style>
</head>

<body>
    <center>
        <h3>WiFi Config</h3>
        <hr>
        <button value="SCAN WIFI" onclick="window.location.reload();">SCAN WIFI</button>
        <hr>
        <div id="found_networks">
        </div>
        <hr>
        <form action="/sp/save" method="POST">
            <input id="ssid" type="text" name="ssid" placeholder="SSID"><br>
            <input type="text" name="pass" placeholder="password"><br>
            <input type="radio" id="r_client" name="mode" value="client" checked />
            <label for="r_client">Client</label>&nbsp;&nbsp;&nbsp;&nbsp;
            <input type="radio" id="r_ap" name="mode" value="ap" />
            <label for="r_ap">Access Point</label>
            <hr>
            <button>SAVE</button>
        </form>
        <button onclick="window.location.href='/sp/exit';">EXIT</button>
    </center>
    <script>
        scanWiFi();
        function scanWiFi() {
            // let scanResult = "WasiliySoft\nQBR-2041WW_1698\nTP-Link_E11A\nBk\n"; // TODO Remove in prod
            // createFoundNetworks(scanResult); // TODO Remove in prod
            fetch("/sp/scan_networks")
                .then((response) => response.text())
                .then((scanResult) => {
                    console.log(scanResult);
                    createFoundNetworks(scanResult);
                }
                );
        }

        function createFoundNetworks(scanResult) {
            var parent = document.getElementById('found_networks');
            parent.innerHTML = "";
            scanResult.split("\n").forEach(function (item) {
                if (item != "") {
                    console.log(item);
                    var el = createNetworkElement(item);
                    parent.appendChild(el);
                }
            });
        }
        function createNetworkElement(networkName) {
            var el = document.createElement("button");

            el.innerText = networkName;
            el.onclick = function () {
                pasteSSID(networkName);
                // alert(networkName);
            };
            return el;
        }

        function pasteSSID(networkName) {
            document.getElementById('ssid').value = networkName;
        }
    </script>
</body>

</html>